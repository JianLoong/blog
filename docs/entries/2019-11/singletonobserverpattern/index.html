<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.75.1" />
    <meta name="description" content="">


    <link rel="icon" href="/blog/images/favicon.ico" type="image/ico">

    <title>Singleton &amp; Observer Pattern (Java) :: Jian Liew</title>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-55422968-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    <link href="/blog/css/nucleus.css?1602314912" rel="stylesheet">
    <link href="/blog/css/fontawesome-all.min.css?1602314912" rel="stylesheet">
    <link href="/blog/css/hybrid.css?1602314912" rel="stylesheet">
    <link href="/blog/css/featherlight.min.css?1602314912" rel="stylesheet">
    <link href="/blog/css/perfect-scrollbar.min.css?1602314912" rel="stylesheet">
    <link href="/blog/css/auto-complete.css?1602314912" rel="stylesheet">
    <link href="/blog/css/atom-one-dark-reasonable.css?1602314912" rel="stylesheet">
    <link href="/blog/css/theme.css?1602314912" rel="stylesheet">
    <link href="/blog/css/hugo-theme.css?1602314912" rel="stylesheet">
    
      <link href="/blog/css/theme-blue.css?1602314912" rel="stylesheet">
    

    <script src="/blog/js/jquery-3.3.1.min.js?1602314912"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/blog/entries/2019-11/singletonobserverpattern/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://jianliew.me/blog">
  Jian
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/blog/js/lunr.min.js?1602314912"></script>
<script type="text/javascript" src="/blog/js/auto-complete.js?1602314912"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/jianliew.me\/blog";
    
</script>
<script type="text/javascript" src="/blog/js/search.js?1602314912"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/blog/entries/" title="Blog" class="dd-item
        parent
        
        
        ">
      <a href="/blog/entries/">
          <b></b>Blog
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            


 
  
    
    <li data-nav-id="/blog/entries/2019-11/" title="November 2019" class="dd-item
        parent
        
        
        ">
      <a href="/blog/entries/2019-11/">
          <b></b>November 2019
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/blog/entries/2019-11/firestore/" title="Nested Data in Documents (FireStore)" class="dd-item ">
        <a href="/blog/entries/2019-11/firestore/">
        <b>&nbsp;1st. </b>Nested Data in Documents (FireStore)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/entries/2019-11/singletonobserverpattern/" title="Singleton &amp; Observer Pattern (Java)" class="dd-item active">
        <a href="/blog/entries/2019-11/singletonobserverpattern/">
        <b>&nbsp;3th. </b>Singleton &amp; Observer Pattern (Java)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/entries/2019-11/javascriptsort/" title="JavaScript Sort Stability" class="dd-item ">
        <a href="/blog/entries/2019-11/javascriptsort/">
        <b>&nbsp;4th. </b>JavaScript Sort Stability
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/entries/2019-11/minmax/" title="Min and Max value of an Array (Java)" class="dd-item ">
        <a href="/blog/entries/2019-11/minmax/">
        <b>&nbsp;6th. </b>Min and Max value of an Array (Java)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/entries/2019-11/programmingtoaninterface/" title="Programming to an Interface (Java)" class="dd-item ">
        <a href="/blog/entries/2019-11/programmingtoaninterface/">
        <b>&nbsp;7th. </b>Programming to an Interface (Java)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/entries/2019-11/foreignkeys/" title="Foreign Key Constraint" class="dd-item ">
        <a href="/blog/entries/2019-11/foreignkeys/">
        <b>&nbsp;9th. </b>Foreign Key Constraint
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/blog/archive/" title="Archive" class="dd-item
        
        
        
        ">
      <a href="/blog/archive/">
          <b></b>Archive
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            


 
  
    
    <li data-nav-id="/blog/archive/2019-10/" title="October 2019" class="dd-item
        
        
        
        ">
      <a href="/blog/archive/2019-10/">
          <b></b>October 2019
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/guard/" title="Explicit Else (Guard)" class="dd-item ">
        <a href="/blog/archive/2019-10/guard/">
        <b>&nbsp;1st. </b>Explicit Else (Guard)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/percentage/" title="Reddit Chart" class="dd-item ">
        <a href="/blog/archive/2019-10/percentage/">
        <b>&nbsp;9th. </b>Reddit Chart
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/programmming/" title="Reddit Word Cloud " class="dd-item ">
        <a href="/blog/archive/2019-10/programmming/">
        <b>12th. </b>Reddit Word Cloud 
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/hk/" title="Sentiment Analysis" class="dd-item ">
        <a href="/blog/archive/2019-10/hk/">
        <b>13th. </b>Sentiment Analysis
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/topstories/" title="Hacker News Word Cloud " class="dd-item ">
        <a href="/blog/archive/2019-10/topstories/">
        <b>14th. </b>Hacker News Word Cloud 
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/ga/" title="Genetic Algorithm" class="dd-item ">
        <a href="/blog/archive/2019-10/ga/">
        <b>19th. </b>Genetic Algorithm
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/tsp/" title="TSP using GA" class="dd-item ">
        <a href="/blog/archive/2019-10/tsp/">
        <b>23th. </b>TSP using GA
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/promiseall/" title="Promise All" class="dd-item ">
        <a href="/blog/archive/2019-10/promiseall/">
        <b>25th. </b>Promise All
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/nearestneighbour/" title="k-Nearest Neighbour on Maps" class="dd-item ">
        <a href="/blog/archive/2019-10/nearestneighbour/">
        <b>27th. </b>k-Nearest Neighbour on Maps
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/java13/" title="Java 13 on Ubuntu" class="dd-item ">
        <a href="/blog/archive/2019-10/java13/">
        <b>28th. </b>Java 13 on Ubuntu
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/blog/archive/2019-10/voronoi/" title="Voronoi Diagram" class="dd-item ">
        <a href="/blog/archive/2019-10/voronoi/">
        <b>29th. </b>Voronoi Diagram
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://jianliew.me/blog/cv"><i class='far fa-file fa-fw'></i>&nbsp;Curriculum Vitae</a>
              </li>
          
              <li>
                  <a class="padding" href="https://jianliew.me/blog/timeline"><i class='fas fa-history fa-fw'></i>&nbsp;Time Line</a>
              </li>
          
              <li>
                  <a class="padding" href="https://jianliew.me/blog/tags"><i class='fas fa-tags fa-fw'></i>&nbsp;Tags</a>
              </li>
          
              <li>
                  <a class="padding" href="https://jianliew.me/blog/disclaimer"><i class='fas fa-exclamation-triangle fa-fw'></i>&nbsp;Disclaimer</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/JianLoong"><i class='fab fa-github fa-fw'></i>&nbsp;GitHub Repo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://au.linkedin.com/in/jian-loong-liew-0433ab39"><i class='fab fa-linkedin-in fa-fw'></i>&nbsp;Linkedin</a>
              </li>
          
              <li>
                  <a class="padding" href="mailto:jianloongliew@gmail.com"><i class='fas fa-envelope-square fa-fw'></i>&nbsp;Email</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/blog/'>Contents</a> > <a href='/blog/entries/'>Blog</a> > <a href='/blog/entries/2019-11/'>November 2019</a> > Singleton & Observer Pattern (Java)
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
<div class="tags">

  <a class="tag-link" href="/blog/tags/java">Java</a>

  <a class="tag-link" href="/blog/tags/design-pattern">Design Pattern</a>

  <a class="tag-link" href="/blog/tags/singleton">Singleton</a>

  <a class="tag-link" href="/blog/tags/observer">Observer</a>

</div>

        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Singleton &amp; Observer Pattern (Java)
            </h1>
          

        









  <p>Posted on: <strong> Sunday, November 3, 2019</strong></p>

<p>Reading time: <strong>4 minutes and
    36 seconds.</strong></p>
<hr />



<div class="notices note" ><p>This blog post will demonstrate a simple use case  where the <strong>singleton</strong> and <strong>observable</strong> design pattern becomes important.</p>
</div>

<p>Let&rsquo;s imagine if you are in the arcade and there is a Lucky Dip Machine. The reason I like call it the LuckyDipMachine is because it is one of the feature assignments in the Programming Foundation Units in Monash University and it is often times made fun at. However, the solution for assignment itself <strong>can be engineered to be better.</strong></p>
<ul>
<li>
<p>There is <strong>only one</strong> Lucky Dip Machine in the arcade. This lucky dip machine has a limited number of items in its inventory. A <strong>singleton</strong> design pattern will be used to instantiate this class. The reason for a Singleton pattern is so that, there can only ever be one LuckyDipMachine. Multiple uses of the LuckyDipMachine will only deduct items from this instance.</p>
</li>
<li>
<p>Everyone in the arcade can <strong>observe</strong> when the LuckyDipMachine is used. Whenever, a price is won, the observers would know what Prize has been won.</p>
</li>
</ul>

<div class="mermaid" align="center">

graph TD
    A(LuckyDipMachine<br />Singleton)
    B(ObserverOne)
    C(ObserverTWo)
    D(User)
    B -- observes--> A
    C -- observes--> A
    D -- uses --> A
    A --fire changes --> B
    A --fire changes --> C
</div>

<p align="center">Fig 1. Flowchart Representation of the intended design </p>
<p>We  start off by creating a really simple Prize class.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> me.jianliew<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Prize</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Prize</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>Object o<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span> <span style="color:#f92672">==</span> o<span style="color:#f92672">)</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>o <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> getClass<span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> o<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">())</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

        Prize prize <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Prize<span style="color:#f92672">)</span> o<span style="color:#f92672">;</span>

        <span style="color:#66d9ef">return</span> getName<span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>prize<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">hashCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> getName<span style="color:#f92672">().</span><span style="color:#a6e22e">hashCode</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Prize{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;name=&#39;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p align="center">Snippet 1. The <strong> Prize</strong> class.</p>
<p>Our Prize class is just a plain old Java object.</p>
<p>However, our LuckyDipMachine class is slightly more interesting. Here are the characteristics of it</p>
<ul>
<li>It has a <strong>private</strong> constructor.</li>
<li>It has a <strong>static</strong> instance of itself. This is done as a class variable.</li>
<li>A <strong>PropertyChangeSupport</strong> as a field to create an observable pattern.</li>
<li>A <strong>pull</strong> method of the LuckyDipMachine indicating whenever the lucky dip machine has been pulled or used. When this happens, it will fire a property change done via calling the <strong>firePropertyChange</strong> method.</li>
</ul>
<div></div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> me.jianliew<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.beans.PropertyChangeListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.beans.PropertyChangeSupport<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LuckyDipMachine</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>Prize<span style="color:#f92672">,</span> Integer<span style="color:#f92672">&gt;</span> inventory<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> LuckyDipMachine ourInstance <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LuckyDipMachine<span style="color:#f92672">();</span>

    <span style="color:#75715e">// PropertyChangeSupport is introduced here
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> PropertyChangeSupport support<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> LuckyDipMachine <span style="color:#a6e22e">getInstance</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> ourInstance<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">LuckyDipMachine</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        inventory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
        support <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PropertyChangeSupport<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
        fill<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fill</span><span style="color:#f92672">(){</span>
        Prize p1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Prize<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Potato&#34;</span><span style="color:#f92672">);</span>
        Prize p2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Prize<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tomato&#34;</span><span style="color:#f92672">);</span>
        inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>p1<span style="color:#f92672">,</span>2<span style="color:#f92672">);</span>
        inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>p2<span style="color:#f92672">,</span>2<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> Prize <span style="color:#a6e22e">getRandomPrize</span><span style="color:#f92672">(){</span>
        List<span style="color:#f92672">&lt;</span>Prize<span style="color:#f92672">&gt;</span> keysAsArray <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">keySet</span><span style="color:#f92672">());</span>
        Random r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> keysAsArray<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>r<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>keysAsArray<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pull</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span>
            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
        Prize p <span style="color:#f92672">=</span> getRandomPrize<span style="color:#f92672">();</span>
        inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">computeIfPresent</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>prize<span style="color:#f92672">,</span> integer<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>prize<span style="color:#f92672">)</span> <span style="color:#f92672">-</span>  1<span style="color:#f92672">);</span>

        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>p<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">){</span>
            inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        support<span style="color:#f92672">.</span><span style="color:#a6e22e">firePropertyChange</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;prize&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> p<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getInventorySize</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> sum <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Prize p <span style="color:#f92672">:</span> inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">keySet</span><span style="color:#f92672">())</span> sum <span style="color:#f92672">+=</span> inventory<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> sum<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addPropertyChangeListener</span><span style="color:#f92672">(</span>PropertyChangeListener pcl<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        support<span style="color:#f92672">.</span><span style="color:#a6e22e">addPropertyChangeListener</span><span style="color:#f92672">(</span>pcl<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">removePropertyChangeListener</span><span style="color:#f92672">(</span>PropertyChangeListener pcl<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        support<span style="color:#f92672">.</span><span style="color:#a6e22e">removePropertyChangeListener</span><span style="color:#f92672">(</span>pcl<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;LuckyDipMachine{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;inventory=&#34;</span> <span style="color:#f92672">+</span> inventory <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><div></div>
<p>We also have the Observer. The only thing that is needed in this class is for it to implement the <strong>PropertyChangeListener</strong>. I will also need to have an implementation for the <strong>propertyChange</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> me.jianliew<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.beans.PropertyChangeEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.beans.PropertyChangeListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.ArrayList<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#75715e">// It is needed to implement the interface PropertyChangeListener
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Observer</span> <span style="color:#66d9ef">implements</span> PropertyChangeListener <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Prize<span style="color:#f92672">&gt;</span> observedPrizes<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Observer</span><span style="color:#f92672">(){</span>
        observedPrizes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">propertyChange</span><span style="color:#f92672">(</span>PropertyChangeEvent propertyChangeEvent<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Prize p <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Prize<span style="color:#f92672">)</span> propertyChangeEvent<span style="color:#f92672">.</span><span style="color:#a6e22e">getNewValue</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">observedPrizes</span><span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>toString<span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Observer{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;observedPrizes=&#34;</span> <span style="color:#f92672">+</span> observedPrizes <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><div></div>
We can then have a simple Test class to see how it works.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> me.jianliew<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Test</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        Observer o <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Observer<span style="color:#f92672">();</span>
        LuckyDipMachine ldm <span style="color:#f92672">=</span> LuckyDipMachine<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">();</span>
        ldm<span style="color:#f92672">.</span><span style="color:#a6e22e">addPropertyChangeListener</span><span style="color:#f92672">(</span>o<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>ldm<span style="color:#f92672">.</span><span style="color:#a6e22e">getInventorySize</span><span style="color:#f92672">());</span>
        ldm<span style="color:#f92672">.</span><span style="color:#a6e22e">pull</span><span style="color:#f92672">();</span>
        ldm<span style="color:#f92672">.</span><span style="color:#a6e22e">pull</span><span style="color:#f92672">();</span>
        ldm<span style="color:#f92672">.</span><span style="color:#a6e22e">pull</span><span style="color:#f92672">();</span>
        LuckyDipMachine ldm2<span style="color:#f92672">=</span> LuckyDipMachine<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>ldm2<span style="color:#f92672">.</span><span style="color:#a6e22e">getInventorySize</span><span style="color:#f92672">());</span>
        ldm2<span style="color:#f92672">.</span><span style="color:#a6e22e">pull</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>ldm<span style="color:#f92672">.</span><span style="color:#a6e22e">getInventorySize</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The output of it would be as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">// There will be <span style="color:#ae81ff">4</span> items at the start
<span style="color:#ae81ff">4</span>

// On the first pull a random item is returned. The observer observes it.
Observer<span style="color:#f92672">{</span>observedPrizes<span style="color:#f92672">=[</span>Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Tomato&#39;</span><span style="color:#f92672">}]}</span>

// On the second pull, the observer now sees <span style="color:#ae81ff">2</span> items in total.
Observer<span style="color:#f92672">{</span>observedPrizes<span style="color:#f92672">=[</span>Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Tomato&#39;</span><span style="color:#f92672">}</span>, Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Potato&#39;</span><span style="color:#f92672">}]}</span>

// There will be three items on the third pull.
Observer<span style="color:#f92672">{</span>observedPrizes<span style="color:#f92672">=[</span>Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Tomato&#39;</span><span style="color:#f92672">}</span>, Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Potato&#39;</span><span style="color:#f92672">}</span>, Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Tomato&#39;</span><span style="color:#f92672">}]}</span>

// The second instance of the LuckyDipMachine will still only have <span style="color:#ae81ff">1</span> item as the LuckyDipMachine is a singleton.
<span style="color:#ae81ff">1</span>

// The pull of the second lucky dip machine, still triggers a fire to the observer as it is a singleton. There is no need to register the listener again.
Observer<span style="color:#f92672">{</span>observedPrizes<span style="color:#f92672">=[</span>Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Tomato&#39;</span><span style="color:#f92672">}</span>, Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Potato&#39;</span><span style="color:#f92672">}</span>, Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Tomato&#39;</span><span style="color:#f92672">}</span>, Prize<span style="color:#f92672">{</span>name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Potato&#39;</span><span style="color:#f92672">}]}</span>

// At the end there will be nothing left in the machine.
<span style="color:#ae81ff">0</span>

</code></pre></div><h4 id="lessons-from-this-blog-post">Lessons from this blog post.</h4>
<ul>
<li>It is very important to override both the <strong>equals</strong> and  the <strong>hashCode</strong> when using maps.</li>
<li>The <strong>Singleton</strong> design pattern have many different approaches. The approach which I have used here is the most simplistic approach and does have certain design concerns.</li>
<li>Design is still very subjective matter as it is debatable to put the <strong>quantity</strong> field in the Prize class itself.</li>
<li>The runtime to get a random item from a HashMap would depend on the <strong>implementation</strong> of it.</li>
<li><strong>Pygments</strong> and <strong>Chroma</strong> of the Hugo static website generator are both good but Chroma seems to look nice out of the box for my use case.</li>
<li><strong>PropertyChangeSupport</strong> is so much easier to use compare to the <strong>Observable</strong> interface class.</li>
<li><strong>computeIfPresent</strong> method is pretty cool as it uses a lambda like feature.</li>
</ul>
<h4 id="references">References</h4>
<ol>
<li>quantities, I. and L., E. (2019). Inventory of objects with item types and quantities. [online] Code Review Stack Exchange. Available at: <a href="https://codereview.stackexchange.com/questions/148821/inventory-of-objects-with-item-types-and-quantities">https://codereview.stackexchange.com/questions/148821/inventory-of-objects-with-item-types-and-quantities</a> [Accessed 3 Nov. 2019].</li>
<li>Baeldung. (2019). Singletons in Java | Baeldung. [online] Available at: <a href="https://www.baeldung.com/java-singleton">https://www.baeldung.com/java-singleton</a> [Accessed 3 Nov. 2019].</li>
<li>Baeldung. (2019). The Observer Pattern in Java | Baeldung. [online] Available at: <a href="https://www.baeldung.com/java-observer-pattern">https://www.baeldung.com/java-observer-pattern</a> [Accessed 3 Nov. 2019].</li>
</ol>


<footer class=" footline" >
	
</footer>


        
        </div>
        


<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jianloonggithubio" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/blog/entries/2019-11/firestore/" title="Nested Data in Documents (FireStore)"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/blog/entries/2019-11/javascriptsort/" title="JavaScript Sort Stability" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/blog/js/clipboard.min.js?1602314912"></script>
    <script src="/blog/js/perfect-scrollbar.min.js?1602314912"></script>
    <script src="/blog/js/perfect-scrollbar.jquery.min.js?1602314912"></script>
    <script src="/blog/js/jquery.sticky.js?1602314912"></script>
    <script src="/blog/js/featherlight.min.js?1602314912"></script>
    <script src="/blog/js/highlight.pack.js?1602314912"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/blog/js/modernizr.custom-3.6.0.js?1602314912"></script>
    <script src="/blog/js/learn.js?1602314912"></script>
    <script src="/blog/js/hugo-learn.js?1602314912"></script>

    <link href="/blog/mermaid/mermaid.css?1602314912" rel="stylesheet" />
    <script src="/blog/mermaid/mermaid.js?1602314912"></script>
    <script>
        mermaid.initialize({
          startOnLoad: true,
          flowchart : {
            curve: 'basis'
          },
          classDiagram: {
            htmlLabels: true
          }
        });
    </script>
    

  </body>
</html>

