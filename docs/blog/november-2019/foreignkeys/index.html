<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.59.1"><meta name=description content><link rel=icon href=/blog/images/favicon.ico type=image/ico><title>Foreign Key Constraint :: Jian Liew</title><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-55422968-1','auto');ga('send','pageview');}</script><link href=/blog/css/nucleus.css?1573286964 rel=stylesheet><link href=/blog/css/fontawesome-all.min.css?1573286964 rel=stylesheet><link href=/blog/css/hybrid.css?1573286964 rel=stylesheet><link href=/blog/css/featherlight.min.css?1573286964 rel=stylesheet><link href=/blog/css/perfect-scrollbar.min.css?1573286964 rel=stylesheet><link href=/blog/css/auto-complete.css?1573286964 rel=stylesheet><link href=/blog/css/atom-one-dark-reasonable.css?1573286964 rel=stylesheet><link href=/blog/css/theme.css?1573286964 rel=stylesheet><link href=/blog/css/hugo-theme.css?1573286964 rel=stylesheet><link href=/blog/css/theme-blue.css?1573286964 rel=stylesheet><script src=/blog/js/jquery-3.3.1.min.js?1573286964></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/blog/blog/november-2019/foreignkeys/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://jianliew.me/blog>Jian</a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/blog/js/lunr.min.js?1573286964></script><script type=text/javascript src=/blog/js/auto-complete.js?1573286964></script><script type=text/javascript>var baseurl="https:\/\/jianliew.me\/blog";</script><script type=text/javascript src=/blog/js/search.js?1573286964></script></div><div class=highlightable><ul class=topics><li data-nav-id=/blog/blog/ title=Blog class="dd-item
parent"><a href=/blog/blog/><b></b>Blog</a><ul><li data-nav-id=/blog/blog/november-2019/ title="November 2019" class="dd-item
parent"><a href=/blog/blog/november-2019/><b></b>November 2019</a><ul><li data-nav-id=/blog/blog/november-2019/firestore/ title="Nested Data in Documents (FireStore)" class=dd-item><a href=/blog/blog/november-2019/firestore/><b>1st. </b>Nested Data in Documents (FireStore)</a></li><li data-nav-id=/blog/blog/november-2019/singletonobserverpattern/ title="Singleton &amp; Observer Pattern (Java)" class=dd-item><a href=/blog/blog/november-2019/singletonobserverpattern/><b>3th. </b>Singleton &amp; Observer Pattern (Java)</a></li><li data-nav-id=/blog/blog/november-2019/javascriptsort/ title="JavaScript Sort Stability" class=dd-item><a href=/blog/blog/november-2019/javascriptsort/><b>4th. </b>JavaScript Sort Stability</a></li><li data-nav-id=/blog/blog/november-2019/minmax/ title="Min and Max value of an Array (Java)" class=dd-item><a href=/blog/blog/november-2019/minmax/><b>6th. </b>Min and Max value of an Array (Java)</a></li><li data-nav-id=/blog/blog/november-2019/programmingtoaninterface/ title="Programming to an Interface (Java)" class=dd-item><a href=/blog/blog/november-2019/programmingtoaninterface/><b>7th. </b>Programming to an Interface (Java)</a></li><li data-nav-id=/blog/blog/november-2019/foreignkeys/ title="Foreign Key Constraint" class="dd-item active"><a href=/blog/blog/november-2019/foreignkeys/><b>9th. </b>Foreign Key Constraint</a></li></ul></li></ul></li><li data-nav-id=/blog/thepragmatic/ title="Pragmatic Programmer" class=dd-item><a href=/blog/thepragmatic/><b></b>Pragmatic Programmer</a><ul><li data-nav-id=/blog/thepragmatic/rubberduck/ title="Rubber Duck" class=dd-item><a href=/blog/thepragmatic/rubberduck/><b>1. </b>Rubber Duck</a></li></ul></li><li data-nav-id=/blog/teaching/ title=Teaching class=dd-item><a href=/blog/teaching/><b></b>Teaching</a><ul><li data-nav-id=/blog/teaching/ubuntu/ title=Ubuntu class=dd-item><a href=/blog/teaching/ubuntu/><b></b>Ubuntu</a><ul><li data-nav-id=/blog/teaching/ubuntu/ls/ title="The File System" class=dd-item><a href=/blog/teaching/ubuntu/ls/><b>1. </b>The File System</a></li></ul></li><li data-nav-id=/blog/teaching/uml/ title=UML class=dd-item><a href=/blog/teaching/uml/><b></b>UML</a></li></ul></li><li data-nav-id=/blog/archive/ title=Archive class=dd-item><a href=/blog/archive/><b></b>Archive</a><ul><li data-nav-id=/blog/archive/october-2019/ title="October 2019" class=dd-item><a href=/blog/archive/october-2019/><b></b>October 2019</a><ul><li data-nav-id=/blog/archive/october-2019/guard/ title="Explicit Else (Guard)" class=dd-item><a href=/blog/archive/october-2019/guard/><b>1st. </b>Explicit Else (Guard)</a></li><li data-nav-id=/blog/archive/october-2019/percentage/ title="Reddit Chart" class=dd-item><a href=/blog/archive/october-2019/percentage/><b>9th. </b>Reddit Chart</a></li><li data-nav-id=/blog/archive/october-2019/programmming/ title="Reddit Word Cloud" class=dd-item><a href=/blog/archive/october-2019/programmming/><b>12th. </b>Reddit Word Cloud</a></li><li data-nav-id=/blog/archive/october-2019/hk/ title="Sentiment Analysis" class=dd-item><a href=/blog/archive/october-2019/hk/><b>13th. </b>Sentiment Analysis</a></li><li data-nav-id=/blog/archive/october-2019/topstories/ title="Hacker News Word Cloud" class=dd-item><a href=/blog/archive/october-2019/topstories/><b>14th. </b>Hacker News Word Cloud</a></li><li data-nav-id=/blog/archive/october-2019/ga/ title="Genetic Algorithm" class=dd-item><a href=/blog/archive/october-2019/ga/><b>19th. </b>Genetic Algorithm</a></li><li data-nav-id=/blog/archive/october-2019/tsp/ title="TSP using GA" class=dd-item><a href=/blog/archive/october-2019/tsp/><b>23th. </b>TSP using GA</a></li><li data-nav-id=/blog/archive/october-2019/promiseall/ title="Promise All" class=dd-item><a href=/blog/archive/october-2019/promiseall/><b>25th. </b>Promise All</a></li><li data-nav-id=/blog/archive/october-2019/nearestneighbour/ title="k-Nearest Neighbour on Maps" class=dd-item><a href=/blog/archive/october-2019/nearestneighbour/><b>27th. </b>k-Nearest Neighbour on Maps</a></li><li data-nav-id=/blog/archive/october-2019/java13/ title="Java 13 on Ubuntu" class=dd-item><a href=/blog/archive/october-2019/java13/><b>28th. </b>Java 13 on Ubuntu</a></li><li data-nav-id=/blog/archive/october-2019/voronoi/ title="Voronoi Diagram" class=dd-item><a href=/blog/archive/october-2019/voronoi/><b>29th. </b>Voronoi Diagram</a></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://jianliew.me/blog/cv><i class="far fa-file fa-fw"></i>&nbsp;Curriculum Vitae</a></li><li><a class=padding href=https://jianliew.me/blog/timeline><i class="fas fa-history fa-fw"></i>&nbsp;Time Line</a></li><li><a class=padding href=https://jianliew.me/blog/tags><i class="fas fa-tags fa-fw"></i>&nbsp;Tags</a></li><li><a class=padding href=https://jianliew.me/blog/disclaimer><i class="fas fa-exclamation-triangle fa-fw"></i>&nbsp;Disclaimer</a></li><li><a class=padding href=https://github.com/JianLoong><i class="fab fa-github fa-fw"></i>&nbsp;GitHub Repo</a></li><li><a class=padding href=https://au.linkedin.com/in/jian-loong-liew-0433ab39><i class="fab fa-linkedin-in fa-fw"></i>&nbsp;Linkedin</a></li><li><a class=padding href=mailto:jianloongliew@gmail.com><i class="fas fa-envelope-square fa-fw"></i>&nbsp;Email</a></li></ul></section><section id=footer><p>Built with <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/blog/>Contents</a> > <a href=/blog/blog/>Blog</a> > <a href=/blog/blog/november-2019/>November 2019</a> > Foreign Key Constraint</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><ul><li><ul><li><a href=#introduction>Introduction</a></li><li><a href=#the-context-and-definition>The Context and Definition</a></li><li><a href=#acid-vs-cap>ACID vs CAP</a></li><li><a href=#references>References</a></li></ul></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/blog/tags/foreign-key>Foreign Key</a>
<a class=tag-link href=/blog/tags/sql>SQL</a>
<a class=tag-link href=/blog/tags/database>Database</a>
<a class=tag-link href=/blog/tags/cqrs>CQRS</a></div></div><div id=body-inner><h1>Foreign Key Constraint</h1><p>Posted on: <strong>Saturday, November 9, 2019</strong></p><p>Reading time: <strong>4 minutes and
50 seconds.</strong></p><hr><h4 id=introduction>Introduction</h4><div class="notices note"><p>The motivation for this blog entry is the following post on Hacker News titled <strong>&ldquo;Thoughts on Foreign Key&rdquo;.</strong> Link <a href=https://github.com/github/gh-ost/issues/331#issuecomment-266027731>here</a></p></div><p>Please do note that the post is actually dated <strong>Dec 10, 2016</strong>, this is about 3 years ago. In the post, it is mentioned that <strong>&ldquo;At GitHub we do not use foreign keys, ever, anywhere.&rdquo;</strong>. This post is actually made by Shlomi Noach, who a principal Software Engineer at Github.</p><p>Based on the post it can be seen that the main reasons for not using FKs are as follows</p><ul><li><p>FKs are in your way to shard your database. Your app is accustomed to rely on FK to maintain integrity, instead of doing it on its own. It may even rely on FK to cascade deletes (shudder). When eventually you want to shard or extract data out, you need to change &amp; test the app to an unknown extent.</p></li><li><p>FKs are a performance impact. The fact they require indexes is likely fine, since those indexes are needed anyhow. But the lookup made for each insert/delete is an overhead.</p></li><li><p>FKs don&rsquo;t work well with online schema migrations.</p></li></ul><p><strong>Shlomi also said the following</strong></p><hr><p>Let&rsquo;s say you have two tables, P &amp; C, standing for Parent &amp; Child, respectively. There&rsquo;s a foreign key in C such that each row in C points to some &ldquo;parent&rdquo; value in P.</p><p>Doing schema migration of C is possible. However since foreign keys have unique names, the new (migrated) C table will have a FK with a different name than the original one.</p><p>Doing schema migration of P is just not going to work. Recall that gh-ost renames the table at the end. Alas, when renaming a table away, the FK will move with the renamed table. To create a parent-side FK on the ghost table, one would need to migrate C ; and because gh-ost uses async approach, P and P-ghost are never in complete sync at any point in time (except at lock time) which makes it impossible for C to have both a FK to P and to P-ghost. some integrity will be broken.</p><hr><h4 id=the-context-and-definition>The Context and Definition</h4><p>Before we go <strong>bonkers</strong>, it is important to understand the context of the post itself. When talking about Foreign Keys, it is also good to understand there are two definitions of what a Foreign Key is.</p><ul><li><p><strong>(Definition 1)</strong> - A foreign key joins a table to another table by referencing its primary key.</p></li><li><p><strong>(Defintion 2)</strong> - A foreign key constraint specifies that the key can only contain values that are in the referenced primary key, and thus ensures the referential integrity of data that is joined on the two keys.</p></li></ul><p>In this context, Shlomi is actually referring to the <strong>foreign key constraint.</strong>. Judging by the looks, it seems that the application code itself would be responsible for enforcing these constraints. Perhaps, using the <strong>CQRS</strong> pattern? More information regarding the CQRS pattern can be found <a href=https://martinfowler.com/bliki/CQRS.html>here</a>. The main issue with handling the FK constraint in application code is numerous as there is a need to think of situations where you would like a <strong>DELETE CASCADE</strong> and situations win which you do not.</p><div class="notices tip"><p><strong>Wait!</strong><br>There is also a need to understand the context in where Shlomi is referring and more importantly scale in which is at hand.</p></div><p>In order to understand why this is interesting, there are a few concepts we must first look into. There are two theorems at work here, the <strong>ACID</strong> &amp; <strong>CAP</strong> theorem.</p><h4 id=acid-vs-cap>ACID vs CAP</h4><p>The ACID theorem is probably the most well known theorem.</p><table><thead><tr><th align=center>Acronym</th><th align=left>Meaning</th></tr></thead><tbody><tr><td align=center><strong>A</strong>tomicity</td><td align=left>An atomic transaction is an indivisible and irreducible series of database operations such that either all occur, or nothing occurs.</td></tr><tr><td align=center><strong>C</strong>onsistency</td><td align=left>The guarantee that operations in transactions are performed accurately, correctly, and with validity, with respect to application semantics.</td></tr><tr><td align=center><strong>I</strong>solation</td><td align=left>Determines how transaction integrity is visible to other users and systems.</td></tr><tr><td align=center><strong>D</strong>urability</td><td align=left>Guarantees that transactions that have committed will survive permanently.</td></tr></tbody></table><p align=center>Table 1. The <strong>ACID</strong> theorem.</p><table><thead><tr><th align=center>Acronym</th><th align=left>Meaning</th></tr></thead><tbody><tr><td align=center><strong>C</strong>onsistency</td><td align=left>is a consistency model used in distributed computing to achieve high availability that informally guarantees that, if no new updates are made to a given data item, eventually all accesses to that item will return the last updated value.</td></tr><tr><td align=center><strong>A</strong>vailability</td><td align=left>Every request receives a (non-error) response, without the guarantee that it contains the most recent write</td></tr><tr><td align=center><strong>P</strong>artition tolerance</td><td align=left>The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes</td></tr></tbody></table><p align=center>Table 2. The <strong>CAP</strong> theorem.</p><p>The CAP theorem is slightly more interesting because it is said that it is impossible for a a distributed data store to simultaneously provide more than out of the three guarantees. However, the CAP theorem is often misunderstood as it is assumed that there is need to pick two out of the three however, this is not the case. The CAP theorem semantically means <strong>one cannot have 3 out of 3 guarantees at all times.</strong> But the main idea here is that there is a difference between the ACID theorm and CAP theorem, ACID would address the data consistency of an <strong>individual node</strong> where else the CAP theorem would address the <strong>cluster-wide</strong> data consistency. So, the CAP theorem plays a more importantly role when there is talk about scalability.</p><div class="notices tip"><p>The ACID theorem applies on an individual node, the CAP is for cluster-wide data consistency.</p></div><p>In short, the post is also talking about scaling as well. So, when scaling relational data, sharding would come into the picture as well. With the presence of FKs, the process of sharding, becomes more complicated. From my personal experience, I notice that it is quite common for developers to always drop FK constraints when attempting to do schema migrations but the main key point here is that the migrations are done <strong>online</strong>. Thus, migrations are done without down time.</p><p>But&hellip;..</p><p>At the end of the day, FKs are very important if your company does not operate at the scale in which GitHub operates. It is their design decision to not use FK constraints but every company and their use cases are different.</p><div class="notices warning"><p>Most companies <strong>do not</strong> operate at the scale where there is a need to drop FK constraints. Dropping FK constraints are meant for very specific use cases and architectural designs. It is also important to decide <strong>which database</strong> is more suited for your use case as well.</p></div><h4 id=references>References</h4><ol><li><p><a href=https://www.tutorialspoint.com/sql/sql-foreign-key.htm>https://www.tutorialspoint.com/sql/sql-foreign-key.htm</a></p></li><li><p><a href="https://www.vertica.com/docs/9.2.x/HTML/Content/Authoring/AdministratorsGuide/Constraints/ConstraintTypes/ForeignKeyConstraints.htm?TocPath=Administrator%27s%20Guide%7CConstraints%7CSupported%20Constraints%7C_____2">https://www.vertica.com/docs/9.2.x/HTML/Content/Authoring/AdministratorsGuide/Constraints/ConstraintTypes/ForeignKeyConstraints.htm?TocPath=Administrator%27s%20Guide%7CConstraints%7CSupported%20Constraints%7C_____2</a></p></li><li><p><a href=https://dba.stackexchange.com/questions/31260/consistency-in-acid-and-cap-theorem-are-they-the-same>https://dba.stackexchange.com/questions/31260/consistency-in-acid-and-cap-theorem-are-they-the-same</a></p></li></ol><footer class=footline></footer></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"jianloonggithubio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div id=navigation><a class="nav nav-prev" href=/blog/blog/november-2019/programmingtoaninterface/ title="Programming to an Interface (Java)"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/blog/thepragmatic/ title="Pragmatic Programmer" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/blog/js/clipboard.min.js?1573286964></script><script src=/blog/js/perfect-scrollbar.min.js?1573286964></script><script src=/blog/js/perfect-scrollbar.jquery.min.js?1573286964></script><script src=/blog/js/jquery.sticky.js?1573286964></script><script src=/blog/js/featherlight.min.js?1573286964></script><script src=/blog/js/highlight.pack.js?1573286964></script><script>hljs.initHighlightingOnLoad();</script><script src=/blog/js/modernizr.custom-3.6.0.js?1573286964></script><script src=/blog/js/learn.js?1573286964></script><script src=/blog/js/hugo-learn.js?1573286964></script><link href=/blog/mermaid/mermaid.css?1573286964 rel=stylesheet><script src=/blog/mermaid/mermaid.js?1573286964></script><script>mermaid.initialize({startOnLoad:true,flowchart:{curve:'basis'},classDiagram:{htmlLabels:true}});</script></body></html>