<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.59.1"><meta name=description content><link rel=icon href=/blog/images/favicon.ico type=image/ico><title>Singleton &amp; Observer Pattern (Java) :: Jian Liew</title><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-55422968-1','auto');ga('send','pageview');}</script><link href=/blog/css/nucleus.css?1573286962 rel=stylesheet><link href=/blog/css/fontawesome-all.min.css?1573286962 rel=stylesheet><link href=/blog/css/hybrid.css?1573286962 rel=stylesheet><link href=/blog/css/featherlight.min.css?1573286962 rel=stylesheet><link href=/blog/css/perfect-scrollbar.min.css?1573286962 rel=stylesheet><link href=/blog/css/auto-complete.css?1573286962 rel=stylesheet><link href=/blog/css/atom-one-dark-reasonable.css?1573286962 rel=stylesheet><link href=/blog/css/theme.css?1573286962 rel=stylesheet><link href=/blog/css/hugo-theme.css?1573286962 rel=stylesheet><link href=/blog/css/theme-blue.css?1573286962 rel=stylesheet><script src=/blog/js/jquery-3.3.1.min.js?1573286962></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/blog/blog/november-2019/singletonobserverpattern/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://jianliew.me/blog>Jian</a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/blog/js/lunr.min.js?1573286962></script><script type=text/javascript src=/blog/js/auto-complete.js?1573286962></script><script type=text/javascript>var baseurl="https:\/\/jianliew.me\/blog";</script><script type=text/javascript src=/blog/js/search.js?1573286962></script></div><div class=highlightable><ul class=topics><li data-nav-id=/blog/blog/ title=Blog class="dd-item
parent"><a href=/blog/blog/><b></b>Blog</a><ul><li data-nav-id=/blog/blog/november-2019/ title="November 2019" class="dd-item
parent"><a href=/blog/blog/november-2019/><b></b>November 2019</a><ul><li data-nav-id=/blog/blog/november-2019/firestore/ title="Nested Data in Documents (FireStore)" class=dd-item><a href=/blog/blog/november-2019/firestore/><b>1st. </b>Nested Data in Documents (FireStore)</a></li><li data-nav-id=/blog/blog/november-2019/singletonobserverpattern/ title="Singleton &amp; Observer Pattern (Java)" class="dd-item active"><a href=/blog/blog/november-2019/singletonobserverpattern/><b>3th. </b>Singleton &amp; Observer Pattern (Java)</a></li><li data-nav-id=/blog/blog/november-2019/javascriptsort/ title="JavaScript Sort Stability" class=dd-item><a href=/blog/blog/november-2019/javascriptsort/><b>4th. </b>JavaScript Sort Stability</a></li><li data-nav-id=/blog/blog/november-2019/minmax/ title="Min and Max value of an Array (Java)" class=dd-item><a href=/blog/blog/november-2019/minmax/><b>6th. </b>Min and Max value of an Array (Java)</a></li><li data-nav-id=/blog/blog/november-2019/programmingtoaninterface/ title="Programming to an Interface (Java)" class=dd-item><a href=/blog/blog/november-2019/programmingtoaninterface/><b>7th. </b>Programming to an Interface (Java)</a></li><li data-nav-id=/blog/blog/november-2019/foreignkeys/ title="Foreign Key Constraint" class=dd-item><a href=/blog/blog/november-2019/foreignkeys/><b>9th. </b>Foreign Key Constraint</a></li></ul></li></ul></li><li data-nav-id=/blog/thepragmatic/ title="Pragmatic Programmer" class=dd-item><a href=/blog/thepragmatic/><b></b>Pragmatic Programmer</a><ul><li data-nav-id=/blog/thepragmatic/rubberduck/ title="Rubber Duck" class=dd-item><a href=/blog/thepragmatic/rubberduck/><b>1. </b>Rubber Duck</a></li></ul></li><li data-nav-id=/blog/teaching/ title=Teaching class=dd-item><a href=/blog/teaching/><b></b>Teaching</a><ul><li data-nav-id=/blog/teaching/ubuntu/ title=Ubuntu class=dd-item><a href=/blog/teaching/ubuntu/><b></b>Ubuntu</a><ul><li data-nav-id=/blog/teaching/ubuntu/ls/ title="The File System" class=dd-item><a href=/blog/teaching/ubuntu/ls/><b>1. </b>The File System</a></li></ul></li><li data-nav-id=/blog/teaching/uml/ title=UML class=dd-item><a href=/blog/teaching/uml/><b></b>UML</a></li></ul></li><li data-nav-id=/blog/archive/ title=Archive class=dd-item><a href=/blog/archive/><b></b>Archive</a><ul><li data-nav-id=/blog/archive/october-2019/ title="October 2019" class=dd-item><a href=/blog/archive/october-2019/><b></b>October 2019</a><ul><li data-nav-id=/blog/archive/october-2019/guard/ title="Explicit Else (Guard)" class=dd-item><a href=/blog/archive/october-2019/guard/><b>1st. </b>Explicit Else (Guard)</a></li><li data-nav-id=/blog/archive/october-2019/percentage/ title="Reddit Chart" class=dd-item><a href=/blog/archive/october-2019/percentage/><b>9th. </b>Reddit Chart</a></li><li data-nav-id=/blog/archive/october-2019/programmming/ title="Reddit Word Cloud" class=dd-item><a href=/blog/archive/october-2019/programmming/><b>12th. </b>Reddit Word Cloud</a></li><li data-nav-id=/blog/archive/october-2019/hk/ title="Sentiment Analysis" class=dd-item><a href=/blog/archive/october-2019/hk/><b>13th. </b>Sentiment Analysis</a></li><li data-nav-id=/blog/archive/october-2019/topstories/ title="Hacker News Word Cloud" class=dd-item><a href=/blog/archive/october-2019/topstories/><b>14th. </b>Hacker News Word Cloud</a></li><li data-nav-id=/blog/archive/october-2019/ga/ title="Genetic Algorithm" class=dd-item><a href=/blog/archive/october-2019/ga/><b>19th. </b>Genetic Algorithm</a></li><li data-nav-id=/blog/archive/october-2019/tsp/ title="TSP using GA" class=dd-item><a href=/blog/archive/october-2019/tsp/><b>23th. </b>TSP using GA</a></li><li data-nav-id=/blog/archive/october-2019/promiseall/ title="Promise All" class=dd-item><a href=/blog/archive/october-2019/promiseall/><b>25th. </b>Promise All</a></li><li data-nav-id=/blog/archive/october-2019/nearestneighbour/ title="k-Nearest Neighbour on Maps" class=dd-item><a href=/blog/archive/october-2019/nearestneighbour/><b>27th. </b>k-Nearest Neighbour on Maps</a></li><li data-nav-id=/blog/archive/october-2019/java13/ title="Java 13 on Ubuntu" class=dd-item><a href=/blog/archive/october-2019/java13/><b>28th. </b>Java 13 on Ubuntu</a></li><li data-nav-id=/blog/archive/october-2019/voronoi/ title="Voronoi Diagram" class=dd-item><a href=/blog/archive/october-2019/voronoi/><b>29th. </b>Voronoi Diagram</a></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://jianliew.me/blog/cv><i class="far fa-file fa-fw"></i>&nbsp;Curriculum Vitae</a></li><li><a class=padding href=https://jianliew.me/blog/timeline><i class="fas fa-history fa-fw"></i>&nbsp;Time Line</a></li><li><a class=padding href=https://jianliew.me/blog/tags><i class="fas fa-tags fa-fw"></i>&nbsp;Tags</a></li><li><a class=padding href=https://jianliew.me/blog/disclaimer><i class="fas fa-exclamation-triangle fa-fw"></i>&nbsp;Disclaimer</a></li><li><a class=padding href=https://github.com/JianLoong><i class="fab fa-github fa-fw"></i>&nbsp;GitHub Repo</a></li><li><a class=padding href=https://au.linkedin.com/in/jian-loong-liew-0433ab39><i class="fab fa-linkedin-in fa-fw"></i>&nbsp;Linkedin</a></li><li><a class=padding href=mailto:jianloongliew@gmail.com><i class="fas fa-envelope-square fa-fw"></i>&nbsp;Email</a></li></ul></section><section id=footer><p>Built with <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/blog/>Contents</a> > <a href=/blog/blog/>Blog</a> > <a href=/blog/blog/november-2019/>November 2019</a> > Singleton & Observer Pattern (Java)</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><ul><li><ul><li><a href=#lessons-from-this-blog-post>Lessons from this blog post.</a></li><li><a href=#references>References</a></li></ul></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/blog/tags/java>Java</a>
<a class=tag-link href=/blog/tags/design-pattern>Design Pattern</a>
<a class=tag-link href=/blog/tags/singleton>Singleton</a>
<a class=tag-link href=/blog/tags/observer>Observer</a></div></div><div id=body-inner><h1>Singleton &amp; Observer Pattern (Java)</h1><p>Posted on: <strong>Sunday, November 3, 2019</strong></p><p>Reading time: <strong>4 minutes and
31 seconds.</strong></p><hr><div class="notices note"><p>This blog post will demonstrate a simple use case where the <strong>singleton</strong> and <strong>observable</strong> design pattern becomes important.</p></div><p>Let&rsquo;s imagine if you are in the arcade and there is a Lucky Dip Machine. The reason I like call it the LuckyDipMachine is because it is one of the feature assignments in the Programming Foundation Units in Monash University and it is often times made fun at. However, the solution for assignment itself <strong>can be engineered to be better.</strong></p><ul><li><p>There is <strong>only one</strong> Lucky Dip Machine in the arcade. This lucky dip machine has a limited number of items in its inventory. A <strong>singleton</strong> design pattern will be used to instantiate this class. The reason for a Singleton pattern is so that, there can only ever be one LuckyDipMachine. Multiple uses of the LuckyDipMachine will only deduct items from this instance.</p></li><li><p>Everyone in the arcade can <strong>observe</strong> when the LuckyDipMachine is used. Whenever, a price is won, the observers would know what Prize has been won.</p></li></ul><div class=mermaid align=center>graph TD
A(LuckyDipMachine<br>Singleton)
B(ObserverOne)
C(ObserverTWo)
D(User)
B -- observes--> A
C -- observes--> A
D -- uses --> A
A --fire changes --> B
A --fire changes --> C</div><p align=center>Fig 1. Flowchart Representation of the intended design</p><p>We start off by creating a really simple Prize class.</p><div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-java data-lang=java><span></span><span style=color:#f92672>package</span> <span style=color:#f8f8f2>me.jianliew</span><span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Prize</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#f8f8f2>String</span> <span style=color:#f8f8f2>name</span><span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Prize</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>String</span> <span style=color:#f8f8f2>name</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#f8f8f2>name</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#f8f8f2>String</span> <span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f8f8f2>name</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setName</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>String</span> <span style=color:#f8f8f2>name</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#f8f8f2>name</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>Object</span> <span style=color:#f8f8f2>o</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span> <span style=color:#f92672>==</span> <span style=color:#f8f8f2>o</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#f8f8f2>o</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#f8f8f2>getClass</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#f8f8f2>o</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>())</span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>

        <span style=color:#f8f8f2>Prize</span> <span style=color:#f8f8f2>prize</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#f8f8f2>Prize</span><span style=color:#f92672>)</span> <span style=color:#f8f8f2>o</span><span style=color:#f92672>;</span>

        <span style=color:#66d9ef>return</span> <span style=color:#f8f8f2>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>prize</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>hashCode</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f8f8f2>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>hashCode</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#f8f8f2>String</span> <span style=color:#a6e22e>toString</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&quot;Prize{&quot;</span> <span style=color:#f92672>+</span>
                <span style=color:#e6db74>&quot;name=&#39;&quot;</span> <span style=color:#f92672>+</span> <span style=color:#f8f8f2>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;\&#39;&#39;</span> <span style=color:#f92672>+</span>
                <span style=color:#e6db74>&#39;}&#39;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Our Prize class is just a plain old Java object.</p><p>However, our LuckyDipMachine class is slightly more interesting. Here are the characteristics of it</p><ul><li>It has a <strong>private</strong> constructor.</li><li>It has a <strong>static</strong> instance of itself. This is done as a class variable.</li><li>A <strong>PropertyChangeSupport</strong> as a field to create an observable pattern.</li><li>A <strong>pull</strong> method of the LuckyDipMachine indicating whenever the lucky dip machine has been pulled or used. When this happens, it will fire a property change done via calling the <strong>firePropertyChange</strong> method.</li></ul><div></div><div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-java data-lang=java><span></span><span style=color:#f92672>package</span> <span style=color:#f8f8f2>me.jianliew</span><span style=color:#f92672>;</span>

<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.beans.PropertyChangeListener</span><span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.beans.PropertyChangeSupport</span><span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.util.*</span><span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LuckyDipMachine</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#f8f8f2>Map</span><span style=color:#f92672>&lt;</span><span style=color:#f8f8f2>Prize</span><span style=color:#f92672>,</span> <span style=color:#f8f8f2>Integer</span><span style=color:#f92672>&gt;</span> <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>;</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f8f8f2>LuckyDipMachine</span> <span style=color:#f8f8f2>ourInstance</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>LuckyDipMachine</span><span style=color:#f92672>();</span>

    <span style=color:#66d9ef>private</span> <span style=color:#f8f8f2>PropertyChangeSupport</span> <span style=color:#f8f8f2>support</span><span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f8f8f2>LuckyDipMachine</span> <span style=color:#a6e22e>getInstance</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f8f8f2>ourInstance</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>LuckyDipMachine</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#f8f8f2>inventory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>HashMap</span><span style=color:#f92672>&lt;&gt;();</span>
        <span style=color:#f8f8f2>support</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>PropertyChangeSupport</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
        <span style=color:#f8f8f2>fill</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fill</span><span style=color:#f92672>(){</span>
        <span style=color:#f8f8f2>Prize</span> <span style=color:#f8f8f2>p1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>Prize</span><span style=color:#f92672>(</span><span style=color:#e6db74>&quot;Potato&quot;</span><span style=color:#f92672>);</span>
        <span style=color:#f8f8f2>Prize</span> <span style=color:#f8f8f2>p2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>Prize</span><span style=color:#f92672>(</span><span style=color:#e6db74>&quot;Tomato&quot;</span><span style=color:#f92672>);</span>
        <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p1</span><span style=color:#f92672>,</span><span style=color:#ae81ff>2</span><span style=color:#f92672>);</span>
        <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p2</span><span style=color:#f92672>,</span><span style=color:#ae81ff>2</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#f8f8f2>Prize</span> <span style=color:#a6e22e>getRandomPrize</span><span style=color:#f92672>(){</span>
        <span style=color:#f8f8f2>List</span><span style=color:#f92672>&lt;</span><span style=color:#f8f8f2>Prize</span><span style=color:#f92672>&gt;</span> <span style=color:#f8f8f2>keysAsArray</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>ArrayList</span><span style=color:#f92672>&lt;&gt;(</span><span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>keySet</span><span style=color:#f92672>());</span>
        <span style=color:#f8f8f2>Random</span> <span style=color:#f8f8f2>r</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>Random</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f8f8f2>keysAsArray</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>r</span><span style=color:#f92672>.</span><span style=color:#a6e22e>nextInt</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>keysAsArray</span><span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()));</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pull</span><span style=color:#f92672>(){</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>isEmpty</span><span style=color:#f92672>())</span>
            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
        <span style=color:#f8f8f2>Prize</span> <span style=color:#f8f8f2>p</span> <span style=color:#f92672>=</span> <span style=color:#f8f8f2>getRandomPrize</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>computeIfPresent</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p</span><span style=color:#f92672>,</span> <span style=color:#f92672>(</span><span style=color:#f8f8f2>prize</span><span style=color:#f92672>,</span> <span style=color:#f8f8f2>integer</span><span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>prize</span><span style=color:#f92672>)</span> <span style=color:#f92672>-</span>  <span style=color:#ae81ff>1</span><span style=color:#f92672>);</span>

        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p</span><span style=color:#f92672>)</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>){</span>
            <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p</span><span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>
        <span style=color:#f8f8f2>support</span><span style=color:#f92672>.</span><span style=color:#a6e22e>firePropertyChange</span><span style=color:#f92672>(</span><span style=color:#e6db74>&quot;prize&quot;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&quot;&quot;</span><span style=color:#f92672>,</span> <span style=color:#f8f8f2>p</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getInventorySize</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>int</span> <span style=color:#f8f8f2>sum</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>;</span>
        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#f8f8f2>Prize</span> <span style=color:#f8f8f2>p</span> <span style=color:#f92672>:</span> <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>keySet</span><span style=color:#f92672>())</span> <span style=color:#f8f8f2>sum</span> <span style=color:#f92672>+=</span> <span style=color:#f8f8f2>inventory</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p</span><span style=color:#f92672>);</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f8f8f2>sum</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addPropertyChangeListener</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>PropertyChangeListener</span> <span style=color:#f8f8f2>pcl</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#f8f8f2>support</span><span style=color:#f92672>.</span><span style=color:#a6e22e>addPropertyChangeListener</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>pcl</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>removePropertyChangeListener</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>PropertyChangeListener</span> <span style=color:#f8f8f2>pcl</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#f8f8f2>support</span><span style=color:#f92672>.</span><span style=color:#a6e22e>removePropertyChangeListener</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>pcl</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#f8f8f2>String</span> <span style=color:#a6e22e>toString</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&quot;LuckyDipMachine{&quot;</span> <span style=color:#f92672>+</span>
                <span style=color:#e6db74>&quot;inventory=&quot;</span> <span style=color:#f92672>+</span> <span style=color:#f8f8f2>inventory</span> <span style=color:#f92672>+</span>
                <span style=color:#e6db74>&#39;}&#39;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><div></div><p>We also have the Observer. The only thing that is needed in this class is for it to implement the <strong>PropertyChangeListener</strong>. I will also need to have an implementation for the <strong>propertyChange</strong>.</p><div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-java data-lang=java><span></span><span style=color:#f92672>package</span> <span style=color:#f8f8f2>me.jianliew</span><span style=color:#f92672>;</span>

<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.beans.PropertyChangeEvent</span><span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.beans.PropertyChangeListener</span><span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.util.ArrayList</span><span style=color:#f92672>;</span>
<span style=color:#f92672>import</span> <span style=color:#f8f8f2>java.util.List</span><span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Observer</span> <span style=color:#66d9ef>implements</span> <span style=color:#f8f8f2>PropertyChangeListener</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#f8f8f2>List</span><span style=color:#f92672>&lt;</span><span style=color:#f8f8f2>Prize</span><span style=color:#f92672>&gt;</span> <span style=color:#f8f8f2>observedPrizes</span><span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Observer</span><span style=color:#f92672>(){</span>
        <span style=color:#f8f8f2>observedPrizes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>ArrayList</span><span style=color:#f92672>&lt;&gt;();</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>propertyChange</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>PropertyChangeEvent</span> <span style=color:#f8f8f2>propertyChangeEvent</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#f8f8f2>Prize</span> <span style=color:#f8f8f2>p</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#f8f8f2>Prize</span><span style=color:#f92672>)</span> <span style=color:#f8f8f2>propertyChangeEvent</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getNewValue</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>observedPrizes</span><span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>p</span><span style=color:#f92672>);</span>
        <span style=color:#f8f8f2>System</span><span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>toString</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
    
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#f8f8f2>String</span> <span style=color:#a6e22e>toString</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&quot;Observer{&quot;</span> <span style=color:#f92672>+</span>
                <span style=color:#e6db74>&quot;observedPrizes=&quot;</span> <span style=color:#f92672>+</span> <span style=color:#f8f8f2>observedPrizes</span> <span style=color:#f92672>+</span>
                <span style=color:#e6db74>&#39;}&#39;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><div></div>We can then have a simple Test class to see how it works.</p><div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-java data-lang=java><span></span><span style=color:#f92672>package</span> <span style=color:#f8f8f2>me.jianliew</span><span style=color:#f92672>;</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span> <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>String</span><span style=color:#f92672>[]</span> <span style=color:#f8f8f2>args</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>

        <span style=color:#f8f8f2>Observer</span> <span style=color:#f8f8f2>o</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#f8f8f2>Observer</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>LuckyDipMachine</span> <span style=color:#f8f8f2>ldm</span> <span style=color:#f92672>=</span> <span style=color:#f8f8f2>LuckyDipMachine</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInstance</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>ldm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>addPropertyChangeListener</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>o</span><span style=color:#f92672>);</span>
        <span style=color:#f8f8f2>System</span><span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>ldm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInventorySize</span><span style=color:#f92672>());</span>
        <span style=color:#f8f8f2>ldm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pull</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>ldm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pull</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>ldm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pull</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>LuckyDipMachine</span> <span style=color:#f8f8f2>ldm2</span><span style=color:#f92672>=</span> <span style=color:#f8f8f2>LuckyDipMachine</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInstance</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>System</span><span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>ldm2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInventorySize</span><span style=color:#f92672>());</span>
        <span style=color:#f8f8f2>ldm2</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pull</span><span style=color:#f92672>();</span>
        <span style=color:#f8f8f2>System</span><span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#f8f8f2>ldm</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getInventorySize</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The output of it would be as follows.</p><div class=highlight style=background:#272822><pre style=line-height:125%><code class=language-shell data-lang=shell><span></span>// There will be <span style=color:#ae81ff>4</span> items at the start
<span style=color:#ae81ff>4</span>

// On the first pull a random item is returned. The observer observes it.
Observer<span style=color:#f92672>{</span><span style=color:#f8f8f2>observedPrizes</span><span style=color:#f92672>=[</span>Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tomato&#39;</span><span style=color:#f92672>}]}</span>

// On the second pull, the observer now sees <span style=color:#ae81ff>2</span> items in total.
Observer<span style=color:#f92672>{</span><span style=color:#f8f8f2>observedPrizes</span><span style=color:#f92672>=[</span>Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tomato&#39;</span><span style=color:#f92672>}</span>, Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Potato&#39;</span><span style=color:#f92672>}]}</span>

// There will be three items on the third pull.
Observer<span style=color:#f92672>{</span><span style=color:#f8f8f2>observedPrizes</span><span style=color:#f92672>=[</span>Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tomato&#39;</span><span style=color:#f92672>}</span>, Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Potato&#39;</span><span style=color:#f92672>}</span>, Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tomato&#39;</span><span style=color:#f92672>}]}</span>

// The second instance of the LuckyDipMachine will still only have <span style=color:#ae81ff>1</span> item as the LuckyDipMachine is a singleton.
<span style=color:#ae81ff>1</span>

// The pull of the second lucky dip machine, still triggers a fire to the observer as it is a singleton. There is no need to register the listener again.
Observer<span style=color:#f92672>{</span><span style=color:#f8f8f2>observedPrizes</span><span style=color:#f92672>=[</span>Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tomato&#39;</span><span style=color:#f92672>}</span>, Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Potato&#39;</span><span style=color:#f92672>}</span>, Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tomato&#39;</span><span style=color:#f92672>}</span>, Prize<span style=color:#f92672>{</span><span style=color:#f8f8f2>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Potato&#39;</span><span style=color:#f92672>}]}</span>

// At the end there will be nothing left in the machine.
<span style=color:#ae81ff>0</span>
</code></pre></div><h4 id=lessons-from-this-blog-post>Lessons from this blog post.</h4><ul><li>It is very important to override both the <strong>equals</strong> and the <strong>hashCode</strong> when using maps.</li><li>The <strong>Singleton</strong> design pattern have many different approaches. The approach which I have used here is the most simplistic approach and does have certain design concerns.</li><li>Design is still very subjective matter as it is debatable to put the <strong>quantity</strong> field in the Prize class itself.</li><li>The runtime to get a random item from a HashMap would depend on the <strong>implementation</strong> of it.</li><li><strong>Pygments</strong> and <strong>Chroma</strong> of the Hugo static website generator are both good but Chroma seems to look nice out of the box for my use case.</li><li><strong>PropertyChangeSupport</strong> is so much easier to use compare to the <strong>Observable</strong> interface class.</li><li><strong>computeIfPresent</strong> method is pretty cool as it uses a lambda like feature.</li></ul><h4 id=references>References</h4><ol><li>quantities, I. and L., E. (2019). Inventory of objects with item types and quantities. [online] Code Review Stack Exchange. Available at: <a href=https://codereview.stackexchange.com/questions/148821/inventory-of-objects-with-item-types-and-quantities>https://codereview.stackexchange.com/questions/148821/inventory-of-objects-with-item-types-and-quantities</a> [Accessed 3 Nov. 2019].</li><li>Baeldung. (2019). Singletons in Java | Baeldung. [online] Available at: <a href=https://www.baeldung.com/java-singleton>https://www.baeldung.com/java-singleton</a> [Accessed 3 Nov. 2019].</li><li>Baeldung. (2019). The Observer Pattern in Java | Baeldung. [online] Available at: <a href=https://www.baeldung.com/java-observer-pattern>https://www.baeldung.com/java-observer-pattern</a> [Accessed 3 Nov. 2019].</li></ol><footer class=footline></footer></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"jianloonggithubio"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div id=navigation><a class="nav nav-prev" href=/blog/blog/november-2019/firestore/ title="Nested Data in Documents (FireStore)"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/blog/blog/november-2019/javascriptsort/ title="JavaScript Sort Stability" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/blog/js/clipboard.min.js?1573286964></script><script src=/blog/js/perfect-scrollbar.min.js?1573286964></script><script src=/blog/js/perfect-scrollbar.jquery.min.js?1573286964></script><script src=/blog/js/jquery.sticky.js?1573286964></script><script src=/blog/js/featherlight.min.js?1573286964></script><script src=/blog/js/highlight.pack.js?1573286964></script><script>hljs.initHighlightingOnLoad();</script><script src=/blog/js/modernizr.custom-3.6.0.js?1573286964></script><script src=/blog/js/learn.js?1573286964></script><script src=/blog/js/hugo-learn.js?1573286964></script><link href=/blog/mermaid/mermaid.css?1573286964 rel=stylesheet><script src=/blog/mermaid/mermaid.js?1573286964></script><script>mermaid.initialize({startOnLoad:true,flowchart:{curve:'basis'},classDiagram:{htmlLabels:true}});</script></body></html>